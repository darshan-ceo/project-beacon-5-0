import React, { createContext, useContext, useReducer, ReactNode } from 'react';

// Types
interface Case {
  id: string;
  caseNumber: string;
  title: string;
  client: string;
  currentStage: 'Scrutiny' | 'Demand' | 'Adjudication' | 'Appeals' | 'GSTAT' | 'HC' | 'SC';
  priority: 'High' | 'Medium' | 'Low';
  slaStatus: 'Green' | 'Amber' | 'Red';
  nextHearing?: {
    date: string;
    court: string;
    type: 'Adjourned' | 'Final' | 'Argued';
  };
  assignedTo: string;
  createdDate: string;
  lastUpdated: string;
  documents: number;
  progress: number;
}

interface Task {
  id: string;
  title: string;
  description: string;
  caseId: string;
  caseNumber: string;
  stage: string;
  priority: 'Critical' | 'High' | 'Medium' | 'Low';
  status: 'Not Started' | 'In Progress' | 'Review' | 'Completed' | 'Overdue';
  assignedTo: string;
  assignedBy: string;
  createdDate: string;
  dueDate: string;
  completedDate?: string;
  estimatedHours: number;
  actualHours?: number;
  isAutoGenerated: boolean;
  bundleId?: string;
  dependencies?: string[];
  attachments?: string[];
  escalationLevel: 0 | 1 | 2 | 3;
}

interface Client {
  id: string;
  name: string;
  type: 'Individual' | 'Company' | 'Partnership' | 'Trust' | 'Society';
  email: string;
  phone: string;
  address: string;
  registrationNumber?: string;
  panNumber: string;
  gstNumber?: string;
  status: 'Active' | 'Inactive';
  assignedCA: string;
  registrationDate: string;
  totalCases: number;
  activeCases: number;
  totalInvoiced: number;
}

interface Court {
  id: string;
  name: string;
  type: 'Supreme Court' | 'High Court' | 'District Court' | 'Tribunal' | 'Commission';
  jurisdiction: string;
  address: string;
  establishedYear: number;
  totalJudges: number;
  activeCases: number;
  avgHearingTime: string;
  digitalFiling: boolean;
  workingDays: string[];
}

interface Judge {
  id: string;
  name: string;
  designation: string;
  court: string;
  appointmentDate: string;
  specialization: string[];
  totalCases: number;
  avgDisposalTime: string;
  retirementDate: string;
  status: 'Active' | 'On Leave' | 'Retired';
  contactInfo: {
    chambers: string;
    phone?: string;
    email?: string;
  };
}

interface Document {
  id: string;
  name: string;
  type: string;
  size: number;
  caseId?: string;
  uploadedBy: string;
  uploadedAt: string;
  tags: string[];
  isShared: boolean;
  path: string;
}

// Application State
interface AppState {
  cases: Case[];
  tasks: Task[];
  clients: Client[];
  courts: Court[];
  judges: Judge[];
  documents: Document[];
  isLoading: boolean;
  error: string | null;
}

// Actions
type AppAction =
  | { type: 'SET_LOADING'; payload: boolean }
  | { type: 'SET_ERROR'; payload: string | null }
  | { type: 'ADD_CASE'; payload: Case }
  | { type: 'UPDATE_CASE'; payload: Case }
  | { type: 'DELETE_CASE'; payload: string }
  | { type: 'ADD_TASK'; payload: Task }
  | { type: 'UPDATE_TASK'; payload: Task }
  | { type: 'DELETE_TASK'; payload: string }
  | { type: 'ADD_CLIENT'; payload: Client }
  | { type: 'UPDATE_CLIENT'; payload: Client }
  | { type: 'DELETE_CLIENT'; payload: string }
  | { type: 'ADD_COURT'; payload: Court }
  | { type: 'UPDATE_COURT'; payload: Court }
  | { type: 'DELETE_COURT'; payload: string }
  | { type: 'ADD_JUDGE'; payload: Judge }
  | { type: 'UPDATE_JUDGE'; payload: Judge }
  | { type: 'DELETE_JUDGE'; payload: string }
  | { type: 'ADD_DOCUMENT'; payload: Document }
  | { type: 'DELETE_DOCUMENT'; payload: string };

// Initial state with mock data
const initialState: AppState = {
  cases: [
    {
      id: '1',
      caseNumber: 'CASE-2024-001',
      title: 'Tax Assessment Appeal - Acme Corp',
      client: 'Acme Corporation Ltd',
      currentStage: 'Adjudication',
      priority: 'High',
      slaStatus: 'Red',
      nextHearing: {
        date: '2024-02-15',
        court: 'Income Tax Appellate Tribunal',
        type: 'Final'
      },
      assignedTo: 'John Smith',
      createdDate: '2024-01-10',
      lastUpdated: '2024-01-20',
      documents: 15,
      progress: 65
    },
    {
      id: '2',
      caseNumber: 'CASE-2024-002',
      title: 'GST Demand Notice Challenge',
      client: 'Global Tech Solutions',
      currentStage: 'Demand',
      priority: 'Medium',
      slaStatus: 'Amber',
      assignedTo: 'Sarah Johnson',
      createdDate: '2024-01-15',
      lastUpdated: '2024-01-22',
      documents: 8,
      progress: 40
    }
  ],
  tasks: [
    {
      id: '1',
      title: 'Draft Response to DRC-01 Notice',
      description: 'Prepare comprehensive response addressing all points raised in the demand notice',
      caseId: '1',
      caseNumber: 'CASE-2024-001',
      stage: 'Demand',
      priority: 'Critical',
      status: 'Overdue',
      assignedTo: 'John Smith',
      assignedBy: 'Mike Wilson',
      createdDate: '2024-01-15',
      dueDate: '2024-01-20',
      estimatedHours: 16,
      actualHours: 20,
      isAutoGenerated: true,
      bundleId: 'demand-response-bundle',
      escalationLevel: 2
    }
  ],
  clients: [
    {
      id: '1',
      name: 'Acme Corporation Ltd',
      type: 'Company',
      email: 'contact@acme.com',
      phone: '+91-9876543210',
      address: '123 Business Park, Mumbai',
      registrationNumber: 'U12345MH2020PLC123456',
      panNumber: 'ABCDE1234F',
      gstNumber: '27ABCDE1234F1Z5',
      status: 'Active',
      assignedCA: 'John Smith',
      registrationDate: '2024-01-15',
      totalCases: 5,
      activeCases: 2,
      totalInvoiced: 250000
    }
  ],
  courts: [
    {
      id: '1',
      name: 'Income Tax Appellate Tribunal',
      type: 'Tribunal',
      jurisdiction: 'Mumbai',
      address: 'Aayakar Bhavan, M.K. Road, Mumbai',
      establishedYear: 1941,
      totalJudges: 15,
      activeCases: 450,
      avgHearingTime: '45 mins',
      digitalFiling: true,
      workingDays: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday']
    }
  ],
  judges: [
    {
      id: '1',
      name: 'Justice Rajesh Sharma',
      designation: 'Chief Justice',
      court: 'Income Tax Appellate Tribunal',
      appointmentDate: '2015-06-15',
      specialization: ['Tax Law', 'Corporate Law'],
      totalCases: 1250,
      avgDisposalTime: '8 months',
      retirementDate: '2030-06-14',
      status: 'Active',
      contactInfo: {
        chambers: 'Chamber No. 15, ITAT Mumbai',
        phone: '+91-22-12345678',
        email: 'justice.sharma@itat.gov.in'
      }
    }
  ],
  documents: [
    {
      id: '1',
      name: 'DRC-01 Notice.pdf',
      type: 'pdf',
      size: 1024000,
      caseId: '1',
      uploadedBy: 'John Smith',
      uploadedAt: '2024-01-15T10:30:00Z',
      tags: ['Notice', 'DRC-01', 'Important'],
      isShared: false,
      path: '/documents/case-1/drc-01-notice.pdf'
    }
  ],
  isLoading: false,
  error: null
};

// Reducer
function appReducer(state: AppState, action: AppAction): AppState {
  switch (action.type) {
    case 'SET_LOADING':
      return { ...state, isLoading: action.payload };
    case 'SET_ERROR':
      return { ...state, error: action.payload };
    case 'ADD_CASE':
      return { ...state, cases: [...state.cases, action.payload] };
    case 'UPDATE_CASE':
      return {
        ...state,
        cases: state.cases.map(c => c.id === action.payload.id ? action.payload : c)
      };
    case 'DELETE_CASE':
      return {
        ...state,
        cases: state.cases.filter(c => c.id !== action.payload)
      };
    case 'ADD_TASK':
      return { ...state, tasks: [...state.tasks, action.payload] };
    case 'UPDATE_TASK':
      return {
        ...state,
        tasks: state.tasks.map(t => t.id === action.payload.id ? action.payload : t)
      };
    case 'DELETE_TASK':
      return {
        ...state,
        tasks: state.tasks.filter(t => t.id !== action.payload)
      };
    case 'ADD_CLIENT':
      return { ...state, clients: [...state.clients, action.payload] };
    case 'UPDATE_CLIENT':
      return {
        ...state,
        clients: state.clients.map(c => c.id === action.payload.id ? action.payload : c)
      };
    case 'DELETE_CLIENT':
      return {
        ...state,
        clients: state.clients.filter(c => c.id !== action.payload)
      };
    case 'ADD_COURT':
      return { ...state, courts: [...state.courts, action.payload] };
    case 'UPDATE_COURT':
      return {
        ...state,
        courts: state.courts.map(c => c.id === action.payload.id ? action.payload : c)
      };
    case 'DELETE_COURT':
      return {
        ...state,
        courts: state.courts.filter(c => c.id !== action.payload)
      };
    case 'ADD_JUDGE':
      return { ...state, judges: [...state.judges, action.payload] };
    case 'UPDATE_JUDGE':
      return {
        ...state,
        judges: state.judges.map(j => j.id === action.payload.id ? action.payload : j)
      };
    case 'DELETE_JUDGE':
      return {
        ...state,
        judges: state.judges.filter(j => j.id !== action.payload)
      };
    case 'ADD_DOCUMENT':
      return { ...state, documents: [...state.documents, action.payload] };
    case 'DELETE_DOCUMENT':
      return {
        ...state,
        documents: state.documents.filter(d => d.id !== action.payload)
      };
    default:
      return state;
  }
}

// Context
const AppStateContext = createContext<{
  state: AppState;
  dispatch: React.Dispatch<AppAction>;
} | null>(null);

// Provider
export const AppStateProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [state, dispatch] = useReducer(appReducer, initialState);

  return (
    <AppStateContext.Provider value={{ state, dispatch }}>
      {children}
    </AppStateContext.Provider>
  );
};

// Hook
export const useAppState = () => {
  const context = useContext(AppStateContext);
  if (!context) {
    throw new Error('useAppState must be used within AppStateProvider');
  }
  return context;
};

// Export types
export type { Case, Task, Client, Court, Judge, Document };